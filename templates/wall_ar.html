<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Wall AR Studio</title>

<style>
body{
margin:0;
overflow:hidden;
background:black;
font-family:Arial;
}

/* Camera */
video{
position:fixed;
top:0;
left:0;
width:100%;
height:100%;
object-fit:cover;
z-index:1;
}

/* AR Plates */
.arPlate{
position:fixed;
top:50%;
left:50%;
width:200px;
height:200px;
transform:translate(-50%,-50%);
z-index:5;
touch-action:none;
cursor:grab;
border-radius:10px;
}

/* Control Panel */
.panel{
position:fixed;
bottom:30px;
left:50%;
transform:translateX(-50%);
background:rgba(0,0,0,.7);
padding:20px;
border-radius:15px;
color:white;
z-index:20;
text-align:center;
}
</style>
</head>

<body>

<div class="panel">
ðŸŽ¨ Wall AR Studio<br><br>

RGB Color:
<input type="color" id="colorPick">

<button onclick="addColor()">Add Color</button><br><br>

Upload Texture:
<input type="file" id="texUpload">
<button onclick="addTexture()">Add Texture</button>

</div>

<script>

/* ---------- CAMERA ---------- */

async function startCamera(){
try{
const stream=await navigator.mediaDevices.getUserMedia({
video:{facingMode:{ideal:"environment"}}
});

let video=document.createElement("video");
video.srcObject=stream;
video.autoplay=true;
video.playsInline=true;
document.body.appendChild(video);

}catch(e){
alert("Camera permission needed");
}
}

window.onload=startCamera;


/* ---------- CREATE COLOR PLATE ---------- */

function addColor(){
const color=document.getElementById("colorPick").value;

let div=document.createElement("div");
div.className="arPlate";
div.style.background=color;

enableGesture(div);
document.body.appendChild(div);
}


/* ---------- CREATE TEXTURE PLATE ---------- */

function addTexture(){

let file=document.getElementById("texUpload").files[0];
if(!file) return alert("Upload texture");

let url=URL.createObjectURL(file);

let div=document.createElement("div");
div.className="arPlate";
div.style.background=`url(${url}) center/cover`;

enableGesture(div);
document.body.appendChild(div);
}


/* ---------- GESTURE SYSTEM ---------- */

function enableGesture(el){

let scale=1, rot=0, x=0, y=0;
let startX=0,startY=0,startDist=0,startAng=0;

/* TOUCH */
el.addEventListener("touchstart",e=>{
if(e.touches.length==1){
startX=e.touches[0].clientX-x;
startY=e.touches[0].clientY-y;
}

if(e.touches.length==2){
startDist=getDist(e);
startAng=getAng(e);
}
});

el.addEventListener("touchmove",e=>{
e.preventDefault();

if(e.touches.length==1){
x=e.touches[0].clientX-startX;
y=e.touches[0].clientY-startY;
}

if(e.touches.length==2){
let d=getDist(e);
scale*=d/startDist;
startDist=d;

let a=getAng(e);
rot+=a-startAng;
startAng=a;
}

update();
});


/* DESKTOP */
let md=false;

el.addEventListener("mousedown",e=>{
md=true;
startX=e.clientX-x;
startY=e.clientY-y;
});

window.addEventListener("mousemove",e=>{
if(!md) return;
x=e.clientX-startX;
y=e.clientY-startY;
update();
});

window.addEventListener("mouseup",()=>md=false);

/* WHEEL ZOOM */
el.addEventListener("wheel",e=>{
e.preventDefault();
scale+=e.deltaY*-0.001;
update();
});


function update(){
el.style.transform=
`translate(calc(-50% + ${x}px),
calc(-50% + ${y}px))
scale(${scale})
rotate(${rot}deg)`;
}

}

/* Helpers */

function getDist(e){
let dx=e.touches[0].clientX-e.touches[1].clientX;
let dy=e.touches[0].clientY-e.touches[1].clientY;
return Math.sqrt(dx*dx+dy*dy);
}

function getAng(e){
let dx=e.touches[1].clientX-e.touches[0].clientX;
let dy=e.touches[1].clientY-e.touches[0].clientY;
return Math.atan2(dy,dx)*180/Math.PI;
}

</script>

</body>
</html>