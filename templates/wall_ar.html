<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Wall AR Studio</title>

<style>
body{
margin:0;
overflow:hidden;
background:black;
font-family:Arial,Helvetica,sans-serif;
}

/* CAMERA */
video{
position:fixed;
top:0;
left:0;
width:100vw;
height:100vh;
object-fit:cover;
z-index:0;
}

/* AR PLATE */
.arPlate{
position:fixed;
top:50%;
left:50%;
width:260px;
height:180px;
transform:translate(-50%,-50%);
z-index:5;
cursor:grab;
border-radius:12px;
box-shadow:0 20px 50px rgba(0,0,0,.7);
transition:.25s;
}

/* ACTIVE */
.arPlate.active{
outline:2px solid #00e5ff;
}

/* DELETE BUTTON */
.deleteBtn{
position:absolute;
top:-12px;
right:-12px;
background:red;
color:white;
width:26px;
height:26px;
border-radius:50%;
display:flex;
align-items:center;
justify-content:center;
font-weight:bold;
opacity:0;
pointer-events:none;
}

.arPlate.active .deleteBtn{
opacity:1;
pointer-events:auto;
}

/* ===== RESIZE HANDLES (ALL SIDES) ===== */
.handle{
position:absolute;
background:#00e5ff;
border-radius:50%;
width:14px;
height:14px;
opacity:0;
pointer-events:none;
}

.arPlate.active .handle{
opacity:1;
pointer-events:auto;
}

/* Corners */
.tl{top:-7px;left:-7px;cursor:nwse-resize;}
.tr{top:-7px;right:-7px;cursor:nesw-resize;}
.bl{bottom:-7px;left:-7px;cursor:nesw-resize;}
.br{bottom:-7px;right:-7px;cursor:nwse-resize;}

/* Edges */
.tm{top:-7px;left:50%;transform:translateX(-50%);cursor:ns-resize;}
.bm{bottom:-7px;left:50%;transform:translateX(-50%);cursor:ns-resize;}
.ml{left:-7px;top:50%;transform:translateY(-50%);cursor:ew-resize;}
.mr{right:-7px;top:50%;transform:translateY(-50%);cursor:ew-resize;}

/* PANEL */
.panel{
position:fixed;
bottom:18px;
left:50%;
transform:translateX(-50%);
display:flex;
align-items:center;
gap:12px;
flex-wrap:wrap;
background:rgba(20,20,20,.55);
padding:10px 20px;
border-radius:50px;
color:white;
z-index:20;
backdrop-filter:blur(14px);
box-shadow:0 15px 40px rgba(0,0,0,.9);
}

/* BUTTON STYLE */
button{
background:linear-gradient(135deg,#00e5ff,#00bcd4);
border:none;
padding:8px 18px;
border-radius:25px;
color:white;
font-weight:600;
cursor:pointer;
font-size:14px;
box-shadow:0 6px 18px rgba(0,188,212,.5);
transition:.25s;
}

button:hover{
transform:translateY(-2px);
box-shadow:0 10px 30px rgba(0,188,212,.8);
}
</style>
</head>

<body>

<div class="panel">
ðŸŽ¨ <b>Wall AR</b>
RGB <input type="color" id="colorPick">
<button onclick="addColor()">Add</button>

<input type="file" id="texUpload">
<button onclick="addTexture()">Texture</button>

<button onclick="captureAR()">ðŸ“¸ Capture</button>
</div>

<script>

/* CAMERA */
async function startCamera(){
try{
const stream=await navigator.mediaDevices.getUserMedia({
video:{facingMode:{ideal:"environment"}}
});
let video=document.createElement("video");
video.srcObject=stream;
video.autoplay=true;
video.playsInline=true;
video.muted=true;
document.body.prepend(video);
}catch(e){
alert("Camera permission required (HTTPS needed)");
}
}
window.onload=startCamera;


/* CREATE PLATE */
function createPlate(){

let div=document.createElement("div");
div.className="arPlate";

div.onclick=e=>{
e.stopPropagation();
document.querySelectorAll('.arPlate')
.forEach(p=>p.classList.remove('active'));
div.classList.add('active');
};

/* DELETE */
let del=document.createElement("div");
del.className="deleteBtn";
del.innerHTML="âœ–";
del.onclick=()=>div.remove();
div.appendChild(del);

/* ALL 8 RESIZE HANDLES */
["tl","tr","bl","br","tm","bm","ml","mr"].forEach(c=>{
let h=document.createElement("div");
h.className="handle "+c;
div.appendChild(h);
enableResize(div,h,c);
});

enableGesture(div);
document.body.appendChild(div);

return div;
}

/* CLICK OUTSIDE REMOVE ACTIVE */
document.body.onclick=()=>{
document.querySelectorAll('.arPlate')
.forEach(p=>p.classList.remove('active'));
};


/* ADD COLOR */
function addColor(){
let p=createPlate();
p.style.background=document.getElementById("colorPick").value;
}

/* ADD TEXTURE */
function addTexture(){
let file=document.getElementById("texUpload").files[0];
if(!file) return alert("Upload texture");
let p=createPlate();
p.style.background=`url(${URL.createObjectURL(file)}) center/cover`;
}


/* DRAG + ZOOM + ROTATE */
function enableGesture(el){

let scale=1,rot=0,x=0,y=0;
let startX=0,startY=0,startDist=0,startAng=0;

el.addEventListener("touchstart",e=>{
if(e.touches.length==1){
startX=e.touches[0].clientX-x;
startY=e.touches[0].clientY-y;
}
if(e.touches.length==2){
startDist=getDist(e);
startAng=getAng(e);
}
});

el.addEventListener("touchmove",e=>{
e.preventDefault();

if(e.touches.length==1){
x=e.touches[0].clientX-startX;
y=e.touches[0].clientY-startY;
}

if(e.touches.length==2){
let d=getDist(e);
scale*=d/startDist;
startDist=d;

let a=getAng(e);
rot+=a-startAng;
startAng=a;
}

update();
});

let md=false;
el.addEventListener("mousedown",e=>{
md=true;
startX=e.clientX-x;
startY=e.clientY-y;
});

window.addEventListener("mousemove",e=>{
if(!md) return;
x=e.clientX-startX;
y=e.clientY-startY;
update();
});

window.addEventListener("mouseup",()=>md=false);

function update(){
el.style.transform=
`translate(calc(-50% + ${x}px),
calc(-50% + ${y}px))
scale(${scale})
rotate(${rot}deg)`;
}
}


/* ===== RESIZE LOGIC (ALL SIDES) ===== */
function enableResize(el,handle,type){

let startX,startY,startW,startH;

handle.onmousedown=handle.ontouchstart=function(e){

e.stopPropagation();

startX=e.clientX||e.touches[0].clientX;
startY=e.clientY||e.touches[0].clientY;
startW=el.offsetWidth;
startH=el.offsetHeight;

window.onmousemove=window.ontouchmove=function(e){

let x=e.clientX||e.touches[0].clientX;
let y=e.clientY||e.touches[0].clientY;

let dx=x-startX;
let dy=y-startY;

/* Horizontal */
if(type.includes("r")) el.style.width=startW+dx+"px";
if(type.includes("l")) el.style.width=startW-dx+"px";

/* Vertical */
if(type.includes("b")) el.style.height=startH+dy+"px";
if(type.includes("t")) el.style.height=startH-dy+"px";

};

window.onmouseup=window.ontouchend=function(){
window.onmousemove=null;
};
};
}


/* HELPERS */
function getDist(e){
let dx=e.touches[0].clientX-e.touches[1].clientX;
let dy=e.touches[0].clientY-e.touches[1].clientY;
return Math.sqrt(dx*dx+dy*dy);
}

function getAng(e){
let dx=e.touches[1].clientX-e.touches[0].clientX;
let dy=e.touches[1].clientY-e.touches[0].clientY;
return Math.atan2(dy,dx)*180/Math.PI;
}


/* CAPTURE */
function captureAR(){
html2canvas(document.body).then(canvas=>{
let a=document.createElement("a");
a.href=canvas.toDataURL("image/png");
a.download="AR_Wall.png";
a.click();
});
}

let s=document.createElement("script");
s.src="https://html2canvas.hertzen.com/dist/html2canvas.min.js";
document.head.appendChild(s);

</script>

</body>
</html>