<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>AR Image Viewer</title>

<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

<style>
body{
margin:0;
overflow:hidden;
background:black;
font-family:Arial;
}

video{
position:fixed;
top:0;
left:0;
width:100vw;
height:100vh;
object-fit:cover;
z-index:0;
}

.arImage{
position:fixed;
top:50%;
left:50%;
width:280px;
transform:translate(-50%,-50%);
z-index:5;
border-radius:14px;
box-shadow:0 15px 50px rgba(0,0,0,.7);
touch-action:none;
cursor:grab;
}

.captureBtn{
position:fixed;
bottom:20px;
left:50%;
transform:translateX(-50%);
background:#00bcd4;
padding:12px 28px;
border-radius:30px;
color:white;
border:none;
font-weight:bold;
z-index:20;
}
</style>
</head>

<body>

<!-- CAMERA -->
<video id="cam" autoplay playsinline muted></video>

<!-- AR IMAGE -->
<div class="arImage" id="plate">
<img src="{{ url_for('uploaded_file', filename=filename) }}"
style="width:100%;border-radius:14px">
</div>

<button class="captureBtn" onclick="captureAR()">ðŸ“¸ Capture</button>

<script>

/* CAMERA START */
navigator.mediaDevices.getUserMedia({
video:{facingMode:"environment"}
}).then(stream=>{
document.getElementById("cam").srcObject=stream;
}).catch(()=>{
alert("Camera permission needed.");
});


/* DRAG IMAGE */
let plate=document.getElementById("plate");
let x=0,y=0,scale=1,rot=0,startX,startY;

plate.onmousedown=e=>{
startX=e.clientX-x;
startY=e.clientY-y;

document.onmousemove=e=>{
x=e.clientX-startX;
y=e.clientY-startY;
update();
};

document.onmouseup=()=>document.onmousemove=null;
};

plate.onwheel=e=>{
e.preventDefault();
scale+=e.deltaY*-0.001;
update();
};

function update(){
plate.style.transform=
`translate(calc(-50% + ${x}px),calc(-50% + ${y}px))
scale(${scale}) rotate(${rot}deg)`;
}


/* CAPTURE AR */
function captureAR(){
html2canvas(document.body).then(canvas=>{
let link=document.createElement("a");
link.download="AR_Image.png";
link.href=canvas.toDataURL();
link.click();
});
}

</script>

</body>
</html>